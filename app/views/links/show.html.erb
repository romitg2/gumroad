<% content_for :meta do %>
  <link href="<%= @product.long_url %>" rel="canonical">
  <% if @product.isbn.present? && @product.native_type == Link::NATIVE_TYPE_EBOOK %>
    <script type="application/ld+json">
      <%= {
            "@context" => "https://schema.org/",
            "@type" => "Book",
            "name" => @product.name,
            "description" => ActionController::Base.helpers.strip_tags(@product.html_safe_description).to_s.squish,
            "isbn" => @product.isbn,
            "bookFormat" => "https://schema.org/EBook",
            "url" => @product.long_url,
            "author" => {
              "@type" => "Person",
              "name" => @product.user.name_or_username
            },
            "offers" => {
              "@type" => "Offer",
              "price" => (@product.price_cents / 100.0).to_s,
              "priceCurrency" => @product.price_currency_type.upcase,
              "availability" => "https://schema.org/InStock"
            }
          }.to_json.html_safe %>
    </script>
  <% end %>
<% end %>

<%= render("layouts/custom_styles/style") %>

<%= render("shared/js_needed_notice") %>

<%= load_pack("product") %>
<% if params[:layout] == "profile" %>
  <%= react_component "ProfileProductPage", props: @product_props.merge({ creator_profile: ProfilePresenter.new(pundit_user:, seller: @product.user).creator_profile }), prerender: true %>
<% elsif params[:layout] == "discover" %>
  <%= react_component "DiscoverProductPage", props: @product_props.merge(@discover_props), prerender: true %>
<% elsif params[:embed] || params[:overlay] %>
  <%= react_component "ProductIframePage", props: @product_props, prerender: true %>
<% else %>
  <%= react_component "ProductPage", props: @product_props, prerender: true %>
<% end %>
